version: 2
sources:
  - name: olist_raw
    description: "Raw data from the Olist public dataset"
    database: olist-474416
    schema: olist_raw
    tables:
      - name: orders
        description: "This is the core dataset. From each order you might find all other information."
        columns:
          - name: order_id
            data_tests:
              - not_null
              - unique
          - name: customer_id
            data_tests:
              - not_null

      - name: order_items
        description: "This dataset includes data about the items purchased within each order."
        columns:
          - name: order_id
            data_tests:
              - not_null
              - relationships:
                  field: order_id
                  to: source('olist_raw', 'orders')
          - name: product_id
            data_tests:
              - not_null
              - relationships:
                  field: product_id
                  to: source('olist_raw', 'products')
          - name: order_item_id
            data_tests:
              - not_null
        data_tests:
          - dbt_utils.unique_combination_of_columns:
              arguments:
                combination_of_columns:
                  - order_id
                  - order_item_id

      - name: order_payments
        description: "This dataset includes data about the orders payment options."
        columns:
          - name: order_id
            data_tests:
              - not_null
              - relationships:
                  field: order_id
                  to: source('olist_raw', 'orders')
          - name: payment_value
            data_tests:
              - is_non_negative
        data_tests:
          - dbt_utils.unique_combination_of_columns:
              arguments:
                combination_of_columns:
                  - order_id
                  - payment_sequential

      - name: customers
        description:
          "This dataset has information about the customer and its location. Use it to identify unique customers in the orders dataset and to find the orders delivery location.
          Each order is assigned to a unique customer_id.
          This means that the same customer will get different ids for different orders.
          The purpose of having a customer_unique_id on the dataset is to allow you to identify customers that made repurchases at the store.
          Otherwise you would find that each order had a different customer associated with."
        columns:
          - name: customer_id
            description: "Key to the orders table"
            data_tests:
              - not_null
              - unique
          - name: customer_unique_id
            description: "The true identifier for a customer across all orders."
            data_tests:
              - not_null

      - name: products
        description: "This dataset includes data about the products sold by Olist."
        columns:
          - name: product_id
            data_tests:
              - not_null
              - unique

      - name: product_category_name_translation
        description: "Use this dataset to translate the product_category_name to english."
        columns:
          - name: product_category_name
            data_tests:
              - not_null
              - unique
